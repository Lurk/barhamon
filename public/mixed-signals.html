<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mixed Signals by Serhiy Barhamon</title>
    <meta name="description" content="Mixed Signals by Serhiy Barhamon" />

    <meta property="og:title" content="Mixed Signals by Serhiy Barhamon" />
    <meta property="og:type" content="music.album" />
    <meta property="og:url" content="https://barhamon.com/mixed-signals.html" />
    <meta property="og:image" content="tag" />
    <meta property="og:image:alt" content="Mixed Signals by Serhiy Barhamon" />

    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="icon.png" />

    <link rel="manifest" href="site.webmanifest" />
    <meta name="theme-color" content="#2b2a2a" />
  </head>

  <style>
    @font-face {
      font-family: "dsm";
      src: url("/DejavuSansMono-5m7L.ttf");
    }

    @media (orientation: landscape) {
      :root {
        --w-or-h: 100vh;
      }
    }

    @media (orientation: portrait) {
      :root {
        --w-or-h: 100vw;
      }
    }

    @media all and (display-mode: fullscreen) {
      :root {
        --divider: 31;
      }
    }

    @media all and (display-mode: browser) {
      :root {
        --divider: 36;
      }
    }

    :root {
      --dark: #403f3f;
      --darker: #2b2a2a;
      --extra-dark: #1d1c1c;
      --medium: #a5a5a5;
      --light: #cccccc;
      --lighter: #f2f2f2;
      --font-size: calc(var(--w-or-h) / var(--divider));
    }

    ::selection {
      background: var(--dark);
      text-shadow: none;
    }
    html,
    body {
      padding: 0;
      margin: 0;
      background-color: var(--darker);
      box-sizing: border-box;
      font-size: var(--font-size);
      font-family: "dsm";
      color: var(--dark);
      text-align: center;
    }

    #fullscreen {
      padding: 1ch;
      margin: 1ch;
      background-color: var(--darker);
      font-size: var(--font-size);
    }

    #wrap {
      border: 2px solid var(--dark);
      box-sizing: border-box;
      border-radius: 1ch;
      height: 49ch;
      padding: 2ch;
      aspect-ratio: 1;
      margin: auto;
      min-width: 300px;
      min-height: 300px;
      cursor: pointer;
    }

    #content {
      height: 100%;
      color: var(--medium);
      word-break: break-all;
      overflow: hidden;
      box-sizing: border-box;
      display: grid;
      grid-template-columns: repeat(22, 1fr);
      grid-template-rows: repeat(22, 1fr);
      grid-column-gap: 0;
      grid-row-gap: 0;
    }

    #content div {
      width: 2ch;
      height: 2ch;
    }

    .tag {
      color: var(--lighter);
      text-shadow:
        0 0 1px var(--lighter),
        0 0 2px var(--light),
        0 0 3px var(--medium);

      animation: 8s tag;
    }

    @keyframes tag {
      from {
        color: var(--dark);
        text-shadow:
          0 0 0px var(--dark),
          0 0 0px var(--dark),
          0 0 0px var(--dark);
      }
      to {
        color: var(--lighter);
        text-shadow:
          0 0 1px var(--lighter),
          0 0 2px var(--light),
          0 0 3px var(--medium);
      }
    }
  </style>
  <script>
    function getRandomInt(max) {
      return Math.floor(Math.random() * max);
    }

    function initPos(text) {
      const init = () => new Array(22 * 22).fill(-1);
      return {
        textPos: init(),
        text,
        reinit() {
          this.textPos = init();
          return this;
        },
        encode(string_start, slice_len, start) {
          for (let i = 0; i < slice_len; i++) {
            this.textPos[start + i] = string_start + i;
          }
          return this;
        },
        setText(text) {
          this.text = text;
          this.reinit();
          return this;
        },
        isSet(i) {
          return this.textPos[i] >= 0;
        },
        markVisited(i) {
          this.textPos[i] = -2;
          return this;
        },
        isVisited(i) {
          return this.textPos[i] === -2;
        },
        getChar(i) {
          return this.text[this.textPos[i]];
        },
      };
    }

    function f(e) {}

    const chars =
      "Ư§µØÞĦħƆƔƜ֍ऴॹচଳകლናᑸᑔᗗᘸᘠほをデスㄓ㆗ᓕᖵᖆᔨᙈᙋᙧᕡᕒᓆᐑᐬጥሠሰተነአዠጀ፠፰ჰრაචධවൠరஐસઊ੩ফটտѾѢѤጴፍツポヸㄠㅃㆆㅪ㌦㈥㆔ㆄㄫㄭヱヰぬ〺";

    const pos = initPos("");

    const texts = [
      () =>
        pos
          .setText(
            "                         MIXED SIGNALS                                      BY SERHIY BARHAMON                   ",
          )
          .encode(0, 19, 289)
          .encode(19, 19, 311)
          .encode(38, 19, 333)
          .encode(57, 19, 355)
          .encode(75, 19, 377)
          .encode(94, 19, 399),
      () => {
        next("/mp3/dreams of a welding machine.mp3");
        pos
          .setText("DREAMS OF A WELDING MACHINE")
          .encode(0, 11, 247 - 22)
          .encode(12, 7, 249)
          .encode(20, 7, 249 + 22);
      },
      () => {
        next("/mp3/since the big bang.mp3");
        pos.setText(" SINCE THE BIG BANG ").encode(0, 20, 23);
      },
      () => {
        next("/mp3/anemic royality.mp3");
        pos.setText("ANEMIC ROYALITY").encode(0, 6, 396).encode(7, 8, 418);
      },

      () => {
        next("/mp3/breaking the law.mp3");
        pos.setText(" BREAKING THE LAW ").encode(0, 18, 244);
      },
      () => {
        next("/mp3/moonbase construction worker.mp3");
        pos
          .setText(" MOONBASE CONSTRUCTION WORKER ")
          .encode(0, 10, 160)
          .encode(9, 14, 180)
          .encode(22, 8, 205);
      },
      () => {
        next("/mp3/suspicious activities.mp3");
        pos
          .setText("SUSPICIOUS ACTIVITIES")
          .encode(0, 10, 452)
          .encode(11, 10, 474);
      },
      () => {
        next("/mp3/phase of life.mp3");
        pos.setText(" PHASE OF LIFE ").encode(0, 15, 94);
      },
      () => {
        next("/mp3/will not cry in public.mp3");
        pos
          .setText("WILL NOT CRY IN PUBLIC")
          .encode(0, 22, 0)
          .encode(0, 22, 462);
      },
      () => {
        next("/mp3/ambiguous sources.mp3");
        pos.setText("AMBIGUOUS SOURCES").encode(0, 17, 71);
      },
      () =>
        pos
          .setText(
            "DREAMS OF A WELDING MACHINE SINCE THE BIG BANG MOONBASE CONSTRUCTION WORKER SUSPICIOUS ACTIVITIES PHASE OF LIFE WILL NOT CRY IN PUBLIC AMBIGUOUS SOURCES",
          )
          .encode(0, 19, 22 * 0)
          .encode(20, 7, 22 * 1)
          .encode(28, 18, 22 * 4)
          .encode(47, 21, 22 * 7)
          .encode(69, 6, 22 * 8)
          .encode(76, 21, 22 * 11)
          .encode(98, 13, 22 * 14)
          .encode(112, 22, 22 * 17)
          .encode(135, 17, 22 * 20),
    ];

    texts[0]();

    let current = 1;

    document.onkeydown = ({ keyCode }) => {
      if (keyCode == 37) {
        current = current === 0 ? 0 : current - 1;
        texts[current]();
      } else if (keyCode == 39) {
        current = current === texts.length - 1 ? texts.length - 1 : current + 1;
        texts[current]();
      }
    };

    let p = new Audio("");
    const next = (src) => {
      p.src = src;
      p.load();
      p.play();
    };

    p.addEventListener("ended", (event) => {
      current = current === texts.length - 1 ? texts.length - 1 : current + 1;
      texts[current]();
    });

    const refreshRate = new Array(22 * 22).fill(-1);
    let els = [];

    setTimeout(() => {
      const w = document.getElementById("fullscreen");

      w.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        texts[current]();
        if (document.fullscreen) {
          document.exitFullscreen();
        } else {
          w.requestFullscreen();
        }
      });

      const container = document.getElementById("content");
      container.innerHTML = "<div></div>".repeat(22 * 22);
      els = [...container.children];
      a();
    }, 10);

    function a() {
      requestAnimationFrame(() => {
        const i = getRandomInt(els.length);
        const now = Date.now();

        if (!els.length || now - refreshRate[i] < 1000 || pos.isVisited(i)) {
          return a();
        }

        refreshRate[i] = now;
        const el = els[i];

        el.innerHTML = pos.isSet(i)
          ? pos.getChar(i)
          : chars[getRandomInt(chars.length)];

        if (pos.isSet(i)) {
          pos.markVisited(i);
          el.classList.add("tag");
        } else {
          el.classList.remove("tag");
          el.animate(
            [
              { color: "#403f3f" },
              { color: pos.isSet(i) ? "#ccc" : "#a5a5a5" },
            ],
            {
              duration: 8000,
            },
          );
        }

        a();
      });
    }
  </script>
  <body>
    <div id="fullscreen">
      <div id="wrap">
        <div id="content"></div>
      </div>
    </div>
    <div>click on center of the screen to play.</div>
    <div>left/right arrows to navigate.</div>
  </body>
</html>
